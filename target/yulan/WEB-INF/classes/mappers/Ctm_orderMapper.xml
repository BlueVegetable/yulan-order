<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yulan.dao.Ctm_orderDao">

    <sql id="Base_Column_List_H" >
    ORDER_NO, CUSTOMER_CODE, CUSTOMER_CODE2, CURRENCY_ID, NVL(LINKPERSON,' ') LINKPERSON , NVL(TELEPHONE,' ') TELEPHONE, STATUS_ID,
    DELIVERY_TYPE, DELIVERY_NOTES, POST_ADDRESS, NVL(NOTES,' ') NOTES, to_char(DATE_CRE,'yyyy-MM-dd HH:mm:ss') DATE_CRE, OPERATOR, to_char(DATE_UPDATE,'yyyy-MM-dd HH:mm:ss') DATE_UPDATE,
    PERSON_UPDATE, CONTRACT_NO, PERSON_ACCEPT, to_char(DATE_ACCEPT,'yyyy-MM-dd HH:mm:ss') DATE_ACCEPT, NVL(YULAN_NOTES,' ') YULAN_NOTES, to_char(WEB_TJ_TIME,'yyyy-MM-dd HH:mm:ss') WEB_TJ_TIME,
    DATE_DEAL, FLAG, USER_NO, PROJECT_NO, CUSTOMER_CODE_O2O, ORDER_FLAG, POST_ADDRESS_MODIFIED,
    DS_LINKMAN, DS_TEL, DS_USER_NAME, DS_ORDER_NO, IS_DS_ORDER, ERP_PROCESS_NOTE, INVOICE_FLAG,
    INVOICE_TITLE, NVL(WL_CONTACTS,' ') WL_CONTACTS, NVL(WL_TEL,' ') WL_TEL, RECIVER_AREA1, RECIVER_AREA2, RECIVER_AREA3,
    BILL_TYPE_X, DELIVERY_FLAG, OAO_FLAG, OAO_STATUS, OAO_PERSON,  to_char(OAO_TIME,'yyyy-MM-dd HH:mm:ss') OAO_TIME,NVL(ALL_SPEND,0) ALL_SPEND
  </sql>
    <sql id="Base_Column_List_B" >
    ORDER_NO, LINE_NO, d.ITEM_NO, ITEM_NO_SAMPLE, PRODUCTION_VERSION, QTY_REQUIRED, NVL(to_char(DATE_DELIVER,'yyyy-MM-dd HH:mm:ss'),' ') DATE_DELIVER,
    to_char(DATE_UPDATE,'yyyy-MM-dd HH:mm:ss') DATE_UPDATE, NOTES, STATUS_ID, DISCOUNT, DISCOUNT_FLAG, CURTAIN_KS, CURTAIN_ROOM_NAME,
    CURTAIN_ROOM_ID, CURTAIN_ROOM_LINENO, CURTAIN_WIDTH, CURTAIN_HEIGHT, CURTAIN_HEIGHT2,
    CURTAIN_ITEM_MENU_NOTES, CURTAIN_MENU_GROUP_ID, CURTAIN_SIZE_TIMES, CURTAIN_SIZE_TIMES2,
    ML_NON_STANDARD, CURTAIN_WBH_SIZE, TRANS_TYPE, TRANS_ID,to_char(DATE_DELIVER_KF,'yyyy-MM-dd HH:mm:ss') DATE_DELIVER_KF,to_char(DATE_DELIVER_NB,'yyyy-MM-dd HH:mm:ss') DATE_DELIVER_NB,
    to_char(DATE_DELIVER_FH,'yyyy-MM-dd HH:mm:ss') DATE_DELIVER_FH
  </sql>

    <select id="getOrders" resultType="Map">
        select * from (
        select rownum rn,l.* from
        (select * from
        (select b.brand_name,h.* from
        (select t.note,c.*  from
        (select o.*,i.product_type,i.product_brand from ctm_order_detail d,CTM_ORDER o, item i
        where o.order_no=d.order_no and d.item_no=i.item_no and o.customer_code=#{cid})c,item_type t
        where c.product_type=t.item_type)h,BRAND_TYPE b
        where h.product_brand=b.brand_id)p

        where 1=1
        <if test="state_id!=null">
            and STATUS_ID=#{state_id}
        </if>
        <if test="find!=null">
            and order_no like  '%'||#{find}||'%'
        </if>

        ) l
        where rownum &lt;= #{number})
        where rn &gt;=#{start}

    </select>

    <select id="getOrdersH" resultType="Map">
        select
         *

        from (
        select rownum rn,l.* from
        (select
        <include refid="Base_Column_List_H" />

        from CTM_ORDER t where t.customer_code=#{cid}
            <if test="state_id!=null">
                and STATUS_ID=#{state_id}
            </if>
            <if test="find!=null">
                and order_no like  '%'||#{find}||'%'
            </if>
            <if test="beginTime!=null">
                and web_tj_time between to_date(#{beginTime},'yyyy/mm/dd') and to_date(#{finishTime},'yyyy/mm/dd')
            </if>
        order by t.WEB_TJ_TIME DESC
        ) l
        where rownum &lt;= #{number})
        where rn &gt;=#{start}

    </select>

    <select id="getOrdersB" resultType="Map">
        select b.brand_name,h.* from
        (select t.note,c.*  from
        (select
        <include refid="Base_Column_List_B" />,
        i.product_type,i.product_brand from item i, ctm_order_detail d
        where d.order_no=#{order_no} and d.item_no=i.item_no )c,item_type t
        where c.product_type=t.item_type)h,BRAND_TYPE b
        where h.product_brand=b.brand_id

    </select>

    <select id="countOrders" resultType="Integer">
        select count(*) from
        (select o.*,d.item_no from ctm_order_detail d,CTM_ORDER o where o.order_no=d.order_no and o.customer_code=#{cid} ) c
        where 1=1
        <if test="state_id!=null">
            and c.STATUS_ID=#{state_id}
        </if>
        <if test="find!=null">
            and c.order_no like  '%'||#{find}||'%'
        </if>


    </select>

    <select id="countOrdersH" resultType="Integer">
        select count(*) from CTM_ORDER t where t.customer_code=#{cid}
        <if test="state_id!=null">
            and STATUS_ID=#{state_id}
        </if>
        <if test="find!=null">
            and order_no like  '%'||#{find}||'%'
        </if>
        <if test="beginTime!=null">
            and web_tj_time between to_date(#{beginTime},'yyyy/mm/dd') and to_date(#{finishTime},'yyyy/mm/dd')
        </if>

    </select>

    <select id="getOrderB_content" resultType="Map">
        select b.brand_name,h.* from
        (select t.note,c.*  from
        (select
        <include refid="Base_Column_List_B" />,
        i.product_type,i.product_brand from item i, ctm_order_detail d
        where d.order_no=#{order_no} and d.item_no=#{item_on} and d.item_no=i.item_no  )c,item_type t
        where c.product_type=t.item_type)h,BRAND_TYPE b
        where h.product_brand=b.brand_id

    </select>

    <select id="getPromotion" resultType="Sal_promotion">
        select
          CUSTOMER_CODE, CUSTOMER_TYPE, ORDER_TYPE,
      ORDER_NAME, ITEM_NO, ITEM_VERSION,
      PRODUCT_TYPE, PRODUCT_BRAND, TYPE,
      DISCOUNT, PRICE, FALG_FL,
      QTY_ORDER, QTY_USE, FLAG_XH,
      FLAG_ZX, USE_ID,to_char(DATE_START,'yyyy-MM-dd') DATE_START,
      to_char(DATE_END,'yyyy-MM-dd')DATE_END, GROUP_TYPE
         from SAL_PROMOTION t where t.ORDER_TYPE=#{order_type}
    </select>
    
    <select id="BigDecimal" resultType="BigDecimal">
     select f_get_customer_money(#{cid}) from dual
    </select>

    <insert id="insertOrderH" parameterType="Ctm_order" >
    insert into CTM_ORDER (ORDER_NO, CUSTOMER_CODE, CUSTOMER_CODE2,
      CURRENCY_ID, LINKPERSON, TELEPHONE,
      STATUS_ID, DELIVERY_TYPE, DELIVERY_NOTES,
      POST_ADDRESS, NOTES, DATE_CRE,
      OPERATOR, DATE_UPDATE, PERSON_UPDATE,
      CONTRACT_NO, PERSON_ACCEPT, DATE_ACCEPT,
      YULAN_NOTES, WEB_TJ_TIME, DATE_DEAL,
      FLAG, USER_NO, PROJECT_NO,
      CUSTOMER_CODE_O2O, ORDER_FLAG, POST_ADDRESS_MODIFIED,
      DS_LINKMAN, DS_TEL, DS_USER_NAME,
      DS_ORDER_NO, IS_DS_ORDER, ERP_PROCESS_NOTE,
      INVOICE_FLAG, INVOICE_TITLE, WL_CONTACTS,
      WL_TEL, RECIVER_AREA1, RECIVER_AREA2,
      RECIVER_AREA3, BILL_TYPE_X, DELIVERY_FLAG,
      OAO_FLAG, OAO_STATUS, OAO_PERSON,
      OAO_TIME)
    values (#{orderNo,jdbcType=VARCHAR}, #{customerCode,jdbcType=VARCHAR}, #{customerCode2,jdbcType=VARCHAR},
      #{currencyId,jdbcType=VARCHAR}, #{linkperson,jdbcType=VARCHAR}, #{telephone,jdbcType=VARCHAR},
      #{statusId,jdbcType=VARCHAR}, #{deliveryType,jdbcType=VARCHAR}, #{deliveryNotes,jdbcType=VARCHAR},
      #{postAddress,jdbcType=VARCHAR}, #{notes,jdbcType=VARCHAR}, #{dateCre,jdbcType=TIMESTAMP},
      #{operator,jdbcType=VARCHAR}, #{dateUpdate,jdbcType=TIMESTAMP}, #{personUpdate,jdbcType=VARCHAR},
      #{contractNo,jdbcType=VARCHAR}, #{personAccept,jdbcType=VARCHAR}, #{dateAccept,jdbcType=TIMESTAMP},
      #{yulanNotes,jdbcType=VARCHAR}, #{webTjTime,jdbcType=TIMESTAMP}, #{dateDeal,jdbcType=TIMESTAMP},
      #{flag,jdbcType=VARCHAR}, #{userNo,jdbcType=VARCHAR}, #{projectNo,jdbcType=VARCHAR},
      #{customerCodeO2o,jdbcType=VARCHAR}, #{orderFlag,jdbcType=VARCHAR}, #{postAddressModified,jdbcType=DECIMAL},
      #{dsLinkman,jdbcType=VARCHAR}, #{dsTel,jdbcType=VARCHAR}, #{dsUserName,jdbcType=VARCHAR},
      #{dsOrderNo,jdbcType=VARCHAR}, #{isDsOrder,jdbcType=VARCHAR}, #{erpProcessNote,jdbcType=VARCHAR},
      #{invoiceFlag,jdbcType=VARCHAR}, #{invoiceTitle,jdbcType=VARCHAR}, #{wlContacts,jdbcType=VARCHAR},
      #{wlTel,jdbcType=VARCHAR}, #{reciverArea1,jdbcType=VARCHAR}, #{reciverArea2,jdbcType=VARCHAR},
      #{reciverArea3,jdbcType=VARCHAR}, #{billTypeX,jdbcType=CHAR}, #{deliveryFlag,jdbcType=VARCHAR},
      #{oaoFlag,jdbcType=VARCHAR}, #{oaoStatus,jdbcType=VARCHAR}, #{oaoPerson,jdbcType=VARCHAR},
      #{oaoTime,jdbcType=TIMESTAMP})
  </insert>

    <insert id="insertOrderB" parameterType="Ctm_order_detail" >
    insert into CTM_ORDER_DETAIL (ORDER_NO, LINE_NO, ITEM_NO,
      ITEM_NO_SAMPLE, PRODUCTION_VERSION, QTY_REQUIRED,
      DATE_DELIVER, DATE_UPDATE, NOTES,
      STATUS_ID, DISCOUNT, DISCOUNT_FLAG,
      CURTAIN_KS, CURTAIN_ROOM_NAME, CURTAIN_ROOM_ID,
      CURTAIN_ROOM_LINENO, CURTAIN_WIDTH, CURTAIN_HEIGHT,
      CURTAIN_HEIGHT2, CURTAIN_ITEM_MENU_NOTES, CURTAIN_MENU_GROUP_ID,
      CURTAIN_SIZE_TIMES, CURTAIN_SIZE_TIMES2, ML_NON_STANDARD,
      CURTAIN_WBH_SIZE, TRANS_TYPE, TRANS_ID,
      DATE_DELIVER_KF, DATE_DELIVER_NB, DATE_DELIVER_FH
      )
    values (#{orderNo,jdbcType=VARCHAR}, #{lineNo,jdbcType=DECIMAL}, #{itemNo,jdbcType=VARCHAR},
      #{itemNoSample,jdbcType=VARCHAR}, #{productionVersion,jdbcType=VARCHAR}, #{qtyRequired,jdbcType=DECIMAL},
      #{dateDeliver,jdbcType=TIMESTAMP}, #{dateUpdate,jdbcType=TIMESTAMP}, #{notes,jdbcType=VARCHAR},
      #{statusId,jdbcType=VARCHAR}, #{discount,jdbcType=DECIMAL}, #{discountFlag,jdbcType=VARCHAR},
      #{curtainKs,jdbcType=VARCHAR}, #{curtainRoomName,jdbcType=VARCHAR}, #{curtainRoomId,jdbcType=DECIMAL},
      #{curtainRoomLineno,jdbcType=DECIMAL}, #{curtainWidth,jdbcType=DECIMAL}, #{curtainHeight,jdbcType=DECIMAL},
      #{curtainHeight2,jdbcType=DECIMAL}, #{curtainItemMenuNotes,jdbcType=VARCHAR}, #{curtainMenuGroupId,jdbcType=VARCHAR},
      #{curtainSizeTimes,jdbcType=DECIMAL}, #{curtainSizeTimes2,jdbcType=DECIMAL}, #{mlNonStandard,jdbcType=DECIMAL},
      #{curtainWbhSize,jdbcType=DECIMAL}, #{transType,jdbcType=VARCHAR}, #{transId,jdbcType=VARCHAR},
      #{dateDeliverKf,jdbcType=TIMESTAMP}, #{dateDeliverNb,jdbcType=TIMESTAMP}, #{dateDeliverFh,jdbcType=TIMESTAMP}
      )
  </insert>

    <!--<update id="updateOrderStatus" parameterType="map">
        update CTM_ORDER t
        <set>

        </set>
    </update>-->

</mapper>